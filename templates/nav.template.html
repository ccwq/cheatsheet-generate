<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>Cheatsheet å¯¼è§ˆ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- ç«™ç‚¹ favicon -->
    <link rel="icon" type="image/png" href="assets/brand/cheatsheet.png" />
    <link rel="apple-touch-icon" href="assets/brand/cheatsheet.png" />
    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#69a7ff" />
    <!-- å…¬å…±æ ·å¼ -->
    <link rel="stylesheet" href="assets/common.css" />
    <link rel="stylesheet" href="assets/tags.css" />
    <style>
      /*
       * è®¾è®¡è¯­è¨€å‚è€ƒ base.md ä¸­çš„ "htmlæ¨¡æ¿"
       * ç¬¬1æ¬¡ç¾åŒ–ï¼šæå®¢é£+ç®€çº¦ï¼Œå¢åŠ ç½‘æ ¼è£…é¥°ã€æœç´¢ã€å¾½ç« ã€SVGç®­å¤´ä¸å¾®äº¤äº’
       */

      .container { width: 100%; max-width: 100%; margin: 0 auto; padding: 8px 4px 16px 4px; box-sizing: border-box; position: relative; z-index: 1; }

      /* é¡¶éƒ¨å¤§æ ‡é¢˜ä¸ç½‘ç«™ç›®çš„ï¼ˆMastheadï¼‰ */
      .masthead {
        position: relative; z-index: 1; margin: 8px 0 12px 0; 
        padding: 16px 16px 14px 90px;
        border-radius: 14px; border: 1px solid transparent; overflow: hidden;
        background-image:
          linear-gradient(135deg, rgba(105,167,255,.22), rgba(86,255,229,.22)),
          radial-gradient(1200px 400px at 0% 0%, rgba(110,151,255,.12), rgba(0,0,0,0)),
          linear-gradient(130deg, rgba(34,43,68,.95), rgba(26,32,50,.92));
        background-clip: padding-box, padding-box, padding-box;
        box-shadow: 0 4px 20px rgba(0,0,0,.25), inset 0 0 0 1px rgba(78,85,130,.25);
      }
      .masthead .site-title {
        font-size: 26px; font-weight: 800; letter-spacing: .6px;
        margin: 0 0 6px 0; display:flex; align-items:center; gap:10px;
        position: relative; padding-left: 28px;
        min-height: 34px;
      }
      .masthead .site-title .github-link {
        display: inline-flex; align-items: center; justify-content: center;
        width: 32px; height: 32px; border-radius: 8px;
        background: rgba(255,255,255,0.08); color: #9bc2ff;
        transition: all 0.2s ease; text-decoration: none;
      }
      .masthead .site-title .github-link:hover {
        background: rgba(255,255,255,0.15); color: #fff;
        transform: translateY(-1px);
      }
      .masthead .site-title .github-link svg {
        width: 20px; height: 20px;
      }
      /* å¯¼è§ˆé¡µå“ç‰Œå›¾æ ‡åˆ—ï¼šé«˜åº¦é“ºæ»¡ .site-titleï¼Œä½äºå·¦ä¾§æ•´åˆ— */
      .masthead .site-title::before {
        content: "";
        position: absolute; left: -78px; top: 0; bottom: 0; width: 32px;
        border-radius: 8px;
        background-image: url('assets/brand/cheatsheet.png');
        background-size: cover; background-position: center; background-repeat: no-repeat;
        filter: drop-shadow(0 0 4px rgba(0,0,0,.18));
        width: 90px;
        height: 90px;
      }
      .masthead .site-title .grad-text { background: linear-gradient(90deg,#7bfbb7 0%,#69a7ff 50%,#ffce5b 100%); -webkit-background-clip: text; background-clip: text; color: transparent; }
      .masthead .subtitle { font-size: 13px; color: #cfe4ff; opacity: .95; margin: 0 0 10px 28px; }
      .masthead .purpose { display:flex; flex-wrap:wrap; gap: 8px 10px; margin-left: 28px; }
      /* å¿«æ·é”®è¯´æ˜ Banner */
      .shortcuts { display:flex; flex-wrap:wrap; gap: 8px 12px; margin-left: 28px; align-items: center; }
      .key-chip { 
        display:inline-flex; align-items:center; gap:6px; padding: 4px 10px; 
        border-radius: 6px; border: 1px solid #7bfbb7; 
        background: rgba(123, 251, 183, 0.1); color: #7bfbb7; 
        font-weight: 600; font-size: 13px; 
      }
      .key-chip kbd {
        background: #1a2134; color: #fff; padding: 2px 6px; border-radius: 4px;
        font-family: Consolas, monospace; font-size: 12px; border: 1px solid rgba(123, 251, 183, 0.4);
        box-shadow: 0 2px 0 rgba(0,0,0,0.2);
      }
      .chip { display:inline-flex; align-items:center; gap:6px; padding: 5px 10px; border-radius: 999px; border: 1px solid #3c456e; background: #1a2134; color: #dbe6ff; font-weight: 600; font-size: 12px; }
      /* ç‰ˆæœ¬å·å¾½æ ‡ï¼šç´§éšç«™ç‚¹åæ˜¾ç¤º */
      .ver-chip { display:inline-flex; align-items:center; margin-left: auto; padding: 2px 8px; border-radius: 999px; border: 1px solid #3c456e; background:#1a2134; color:#9bc2ff; font-weight:600; font-size:12px; line-height:1; }
      .chip svg { width: 14px; height: 14px; }
      .masthead .decor { position:absolute; right: -40px; top: -40px; width: 220px; height: 220px; opacity:.18; filter: blur(0.2px); }

      .panel {
        position: sticky; top: 0; z-index: 10;
        display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
        background: var(--panel); border-radius: 12px;
        /* Flat é£æ ¼ï¼šæ— è¾¹æ¡†æ— é˜´å½± */
        border: none; box-shadow: none;
        padding: 10px 14px; margin-bottom: 12px;
        backdrop-filter: blur(6px);
      }
      .brand { display:flex; align-items:center; gap:8px; margin-right:auto; }
      .brand svg { width: 18px; height: 18px; filter: drop-shadow(0 0 6px var(--glow)); }
      .brand .title { color: var(--accent); font-size: 16px; letter-spacing: 0.2px; font-weight: 600; }
      .brand .note { color: #9bc2ff; font-size: 12px; opacity: .9; }

      .panel label { font-size: 1em; color: #ffe49b; font-weight: 700; letter-spacing: 0.2px; }
      .panel .sep { width:1px; height:20px; background: #3e4770; opacity:.7; }
      .slider-bar { min-width: 120px; margin-right: 4px; }
      .slider-val { color: var(--accent-2); font-size: 1em; margin-left: 4px; min-width: 28px; display: inline-block; font-weight: 600; }
      .search { min-width: 200px; max-width: 320px; width: 22vw; padding: 6px 10px; border-radius: 8px; border: none; background:#1f2638; color:#e9eefc; }
      .search::placeholder { color:#9db0d8 }
      .btn { cursor: pointer; padding: 6px 10px; border-radius: 8px; border: none; background:#1f2638; color:#e9eefc; }
      .toggle { display:inline-flex; align-items:center; gap:6px; color:#dbe6ff; font-weight:600; }
      .toggle input { accent-color: #69a7ff; }
      .stats { color:#9ab4ff; font-weight:600; }
      .presets { display:inline-flex; gap:6px; }
      .preset { cursor:pointer; padding:4px 8px; border-radius:999px; border:1px solid #3c456e; background:#1b2032; color:#cfe4ff; }
      .preset:hover { border-color:#4f79ff; }

      /* å¤šåˆ—å®¹å™¨ï¼šæ”¯æŒåˆ—å®½è°ƒèŠ‚ */
      .cheat-columns { column-count: 4; column-gap: 16px; margin-top: 12px; transition: column-width 0.2s ease; column-width: 340px; }
      @media (max-width: 1500px) { .cheat-columns { column-count: 3; } }
      @media (max-width: 1100px) { .cheat-columns { column-count: 2; column-gap: 12px; } }
      @media (max-width: 750px)  { .cheat-columns { column-count: 1; } }

      .card {
        position: relative;
        background: var(--card); border-radius: 12px;
        /* Flat é£æ ¼ï¼šæ— è¾¹æ¡†æ— é˜´å½± */
        border: none; box-shadow: none; backdrop-filter: blur(2px);
        margin-bottom: 14px; padding: 14px 14px 10px 14px; break-inside: avoid; box-sizing: border-box;
      }
      /* å–æ¶ˆå·¦ä¾§é«˜äº®æ¡ï¼Œä¿ç•™çº¯å¹³æ•´æ´ */
      .card::before{ display:none; }
      .card:hover { box-shadow: none; }
      .card h2 { margin: -6px 0 6px 0; font-size: 15px; font-weight: 700; color: var(--title); letter-spacing: 0.6px; display: flex; align-items: center; gap: 8px; }
      .card h2 .link { color: var(--link); font-weight: 700; display: inline-flex; align-items:center; gap:4px; }
      /* æ ‡é¢˜å¯ç‚¹å‡»ï¼šæ·¡æ·¡ä¸‹åˆ’çº¿ï¼Œæ‚¬åœæ›´æ˜æ˜¾ */
      .card h2 .title-link { color: var(--link); text-decoration: underline; text-decoration-color: rgba(147,205,252,.35); text-underline-offset: 2px; }
      .card h2 .title-link:hover { text-decoration-color: rgba(147,205,252,.75); }
      .card .desc { color: var(--desc); margin: 2px 0 2px 0; font-size: 1em; line-height: 1.2; }
      .icon { width: 16px; height: 16px; border-radius: 3px; object-fit: cover; display: inline-block; }
      /* ç§»é™¤æœ¬åœ°/å¯¼å…¥æ ‡ç­¾ï¼ˆä¸å†ä½¿ç”¨ï¼‰ */
      .copy { position:absolute; right:8px; top:8px; opacity:.85; }
      .copy button { background:transparent; border:none; color:#9db0d8; border-radius:8px; padding:4px 6px; cursor:pointer; display:inline-flex; align-items:center; gap:6px; }
      .copy button:hover { color:#cfe4ff; }

      /* è¿”å›é¡¶éƒ¨æŒ‰é’® */
      #backTop { position: fixed; right: 18px; bottom: 18px; z-index: 20; opacity: 0; pointer-events: none; transition: opacity .2s ease; }
      #backTop button { background:#1b2032; color:#d7e6ff; border:none; border-radius:999px; padding:10px; display:flex; align-items:center; justify-content:center; box-shadow: none; }
      #backTop.show { opacity: 0.95; pointer-events: auto; }

      /* å¡ç‰‡é«˜äº®æ ·å¼ */
      .card-highlight {
        border: 2px solid #7bfbb7;
        box-shadow: 0 0 0 2px rgba(123, 251, 183, 0.3);
        background: rgba(123, 251, 183, 0.1);
        transition: all 0.2s ease;
      }

      /* é™å™ªï¼šåŠ¨æ•ˆå¯é€‰ */
      @media (prefers-reduced-motion: reduce) {
        .cheat-columns { transition: none; }
        .card:hover { box-shadow: 0 2px 12px 1px rgba(0,0,0,0.18); }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <section class="masthead" aria-label="ç½‘ç«™ä¿¡æ¯">
        <svg class="decor" viewBox="0 0 200 200" aria-hidden="true" focusable="false">
          <defs>
            <linearGradient id="mgrad" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#69a7ff"/>
              <stop offset="100%" stop-color="#56ffe5"/>
            </linearGradient>
          </defs>
          <path d="M10 40h80l20 20h70v90H10z" fill="none" stroke="url(#mgrad)" stroke-width="3"/>
          <circle cx="18" cy="160" r="4" fill="#69a7ff"/>
          <circle cx="120" cy="64" r="3" fill="#56ffe5"/>
          <circle cx="160" cy="120" r="3" fill="#ffce5b"/>
        </svg>
        <h1 class="site-title">
          <span class="grad-text">æå®¢é€ŸæŸ¥åº“</span>
          <span style="font-size:14px;color:#9bc2ff;opacity:.9;">Cheatsheet Hub</span>
          <span class="ver-chip" title="ç‰ˆæœ¬å·">v__APP_VERSION__</span>
          <a href="https://github.com/ccwq/cheatsheet-generate" class="github-link" target="_blank" rel="noopener" title="GitHub ä»“åº“">
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path fill="currentColor" d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.285 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
            </svg>
          </a>
        </h1>
        <p class="subtitle">ç¦»çº¿èšåˆé«˜è´¨é‡æŠ€æœ¯é€ŸæŸ¥ï¼Œç»Ÿä¸€é£æ ¼ä¸äº¤äº’ï¼Œæä¾›æå¿«çš„æ£€ç´¢ä¸å¯¼èˆªä½“éªŒã€‚(å†…å®¹ç”±AI AGENTæœé›†ç”Ÿæˆ, æ— æ³•ä¿è¯100%å‡†ç¡®, è¯·ä¿æŒè´¨ç–‘ç²¾ç¥)</p>
        <div class="shortcuts">
          <span class="key-chip"><kbd>/</kbd> èšç„¦æœç´¢</span>
          <span class="key-chip"><kbd>Esc</kbd> èšç„¦/å–æ¶ˆ</span>
          <span class="key-chip"><kbd>â†‘â†“â†â†’</kbd> åˆ‡æ¢é«˜äº®</span>
          <span class="key-chip"><kbd>Enter</kbd> æ‰“å¼€æ¡ç›®</span>
        </div>
      </section>
      <div class="panel">
        <div class="brand" title="Cheatsheet Navigation">
          <!-- ç®€æ´æå®¢é£SVGå¾½æ ‡ -->
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path fill="#7bfbb7" d="M3 6h10l2 2h6v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" opacity=".18"/>
            <path fill="#9bc2ff" d="M4 7h8l2 2h6v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z" opacity=".25"/>
            <path fill="#ffce5b" d="M6 15h5v2H6zM6 11h9v2H6zM6 9h7v1H6z"/>
          </svg>
          <div>
            <div class="title">Cheatsheet å¯¼è§ˆ</div>
            <div class="note">æå®¢é£ Â· ç®€çº¦ Â· å¿«é€Ÿæ£€ç´¢</div>
          </div>
        </div>
        <span class="sep"></span>
        <label for="columnWidth">ğŸ”§ åˆ—å®½ï¼š</label>
        <input id="columnWidth" class="slider-bar" type="range" min="300" max="660" value="340" />
        <span id="widthVal" class="slider-val">340px</span>
        <span class="presets">
          <button class="preset" data-w="300">çª„</button>
          <button class="preset" data-w="380">ä¸­</button>
          <button class="preset" data-w="520">å®½</button>
        </span>
        <span class="sep"></span>
        <input id="searchBox" class="search" type="search" placeholder="/ å¿«é€Ÿç­›é€‰ï¼ˆæ ‡é¢˜/ç®€ä»‹ï¼‰" />
        <label class="toggle"><input id="openNew" type="checkbox" /> æ–°çª—å£æ‰“å¼€é“¾æ¥</label>
        <label class="toggle">æ’åº
          <select id="sortSelect" class="btn">
            <option value="name-asc">åç§° â†‘</option>
            <option value="name-desc">åç§° â†“</option>
          </select>
        </label>
        <span id="stats" class="stats"></span>
      </div>
      <div id="columns" class="cheat-columns">
        <!-- CHEATSHEET_ITEMS -->
      </div>
    </div>

    <!-- å…¨å±€å¯å¤ç”¨SVGï¼ˆç®­å¤´ï¼‰ -->
    <svg width="0" height="0" style="position:absolute">
      <defs>
        <symbol id="icon-arrow" viewBox="0 0 24 24">
          <path fill="currentColor" d="M13.172 12L8.222 7.05l1.414-1.414L16 12l-6.364 6.364-1.414-1.414z"/>
        </symbol>
        <symbol id="icon-link" viewBox="0 0 24 24">
          <path fill="currentColor" d="M3.9 12a5 5 0 0 1 5-5h3v2h-3a3 3 0 1 0 0 6h3v2h-3a5 5 0 0 1-5-5Zm7-3h2v6h-2V9Zm4.2-4h3a5 5 0 1 1 0 10h-3v-2h3a3 3 0 1 0 0-6h-3V5Z"/>
        </symbol>
        <symbol id="icon-copy" viewBox="0 0 24 24">
          <path fill="currentColor" d="M8 7h9a2 2 0 0 1 2 2v9h-2V9H8V7Zm-3 3h9a2 2 0 0 1 2 2v9H7a2 2 0 0 1-2-2v-9Z"/>
        </symbol>
        <symbol id="icon-doc" viewBox="0 0 24 24">
          <path fill="currentColor" d="M6 3h8l5 5v13a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1Zm8 6h4l-4-4v4Zm-7 3h10v1H7v-1Zm0 3h10v1H7v-1Z"/>
        </symbol>
        <symbol id="icon-terminal" viewBox="0 0 24 24">
          <path fill="currentColor" d="M3 5h18a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Zm2 3 4 4-4 4-1.4-1.4L6.2 12 3.6 9.4 5 8Zm7 1h7v2h-7V9Z"/>
        </symbol>
        <symbol id="icon-book" viewBox="0 0 24 24">
          <path fill="currentColor" d="M5 3h11a3 3 0 0 1 3 3v13h-2V6a1 1 0 0 0-1-1H5v15H3V6a3 3 0 0 1 3-3Z"/>
        </symbol>
        <symbol id="icon-rocket" viewBox="0 0 24 24">
          <path fill="currentColor" d="M13 2c3 0 6 2.5 6 6.5S15 17 12 20c-3-3-7-8.5-7-11.5S7 2 10 2h3Zm-1.5 7L9 11.5 7.5 10 10 7.5 11.5 9Z"/>
        </symbol>
        <symbol id="icon-cpu" viewBox="0 0 24 24">
          <path fill="currentColor" d="M9 3h2v3h2V3h2v3h2a2 2 0 0 1 2 2v2h3v2h-3v2h3v2h-3v2a2 2 0 0 1-2 2h-2v3h-2v-3h-2v3H9v-3H7a2 2 0 0 1-2-2v-2H2v-2h3v-2H2V10h3V8a2 2 0 0 1 2-2h2V3Zm-2 7v6h10v-6H7Z"/>
        </symbol>
      </defs>
    </svg>

    <!-- è§’è½è£…é¥°SVGï¼ˆç”µè·¯çº¹ç†é£ï¼‰ -->
    <svg viewBox="0 0 160 160" width="160" height="160" style="position:fixed;left:-28px;bottom:-28px;opacity:.12;z-index:0;pointer-events:none;mix-blend-mode:screen;">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#69a7ff"/>
          <stop offset="100%" stop-color="#56ffe5"/>
        </linearGradient>
      </defs>
      <path d="M8 152V80h24v40h16V64h24v64h16v-40h24v24h24v40" fill="none" stroke="url(#g)" stroke-width="2"/>
      <circle cx="8" cy="152" r="3" fill="#69a7ff"/>
      <circle cx="56" cy="64" r="2" fill="#56ffe5"/>
      <circle cx="112" cy="104" r="2" fill="#69a7ff"/>
    </svg>

    <!-- å…¬å…± JS é€»è¾‘ -->
    <script src="assets/common.js"></script>

    <script>
      // ç¬¬1æ¬¡ï¼šåˆ—å®½è°ƒèŠ‚ + æœç´¢è¿‡æ»¤ + è‡ªåŠ¨å¾½ç«  + å¤åˆ¶é“¾æ¥
      (function() {
        var search = $('#searchBox');
        var stats = $('#stats');
        var sortSel = document.getElementById('sortSelect');

        // ä¸ºæ¯å¼ å¡è‡ªåŠ¨æ·»åŠ  copy æŒ‰é’®
        function enhanceCards() {
          var cards = $$('.card');
          cards.forEach(function(card){
            var h2 = $('h2', card);
            var link = $('.link', card);
            if (!h2 || !link) return;
            // è§„èŒƒåŒ–æ ‡é¢˜æ–‡æœ¬ï¼ˆå»é™¤å›¾æ ‡ä¸ç°æœ‰é“¾æ¥æ˜¾ç¤ºå†…å®¹ï¼‰
            var h2clone = h2.cloneNode(true);
            var toRemove = h2clone.querySelector('.link'); if (toRemove) toRemove.remove();
            var iconClone = h2clone.querySelector('.icon'); if (iconClone) iconClone.remove();
            var titleText = (h2clone.textContent || '').trim();

            // æ•°æ®ç¼“å­˜ï¼ˆæœç´¢/æ’åºç”¨ï¼‰
            card.dataset.title = titleText;
            var descRaw = ($('.desc', card)?.textContent || '').trim();
            card.dataset.desc = descRaw;

            // è‹¥æ— å›¾æ ‡ï¼Œæ·»åŠ é»˜è®¤æ–‡æ¡£å›¾æ ‡
            var iconEl = h2.querySelector('.icon');
            if (!iconEl) {
              h2.insertAdjacentHTML('afterbegin', '<svg class="icon" width="16" height="16" viewBox="0 0 24 24"><use href="#icon-doc"/></svg>');
            }

            // å°†æ ‡é¢˜æ–‡æœ¬å˜ä¸ºå¯ç‚¹å‡»é“¾æ¥ï¼ˆä½¿ç”¨åŸæœ‰ .link å…ƒç´ ï¼‰
            // æ¸…ç† h2 ä¸­é™¤å›¾æ ‡ä¸ link å¤–çš„å…¶å®ƒèŠ‚ç‚¹
            var iconKeep = h2.querySelector('.icon');
            Array.from(h2.childNodes).forEach(function(n){ if (n !== iconKeep && n !== link) h2.removeChild(n); });
            link.classList.add('title-link');
            link.innerHTML = '';
            link.appendChild(document.createTextNode(titleText));

            // å¤åˆ¶é“¾æ¥æŒ‰é’®ï¼ˆä¿æŒä½†æ”¹ä¸ºæ›´æ‰å¹³ï¼‰
            var href = link.getAttribute('href') || '';
            var wrap = document.createElement('div');
            wrap.className = 'copy';
            wrap.innerHTML = '<button title="å¤åˆ¶é“¾æ¥"><svg width="14" height="14"><use href="#icon-copy"/></svg>å¤åˆ¶</button>';
            wrap.addEventListener('click', function(){
              try {
                var abs = new URL(href, window.location.href).href; // å…¼å®¹ GitHub Pages åŸºç¡€è·¯å¾„
                navigator.clipboard.writeText(abs);
              } catch(e) { /* ignore */ }
              var btn = wrap.querySelector('button');
              var before = btn.textContent;
              btn.textContent = 'å·²å¤åˆ¶';
              setTimeout(function(){ btn.textContent = before; }, 900);
            });
            card.appendChild(wrap);
          });
        }

        // æœç´¢è¿‡æ»¤ï¼ˆæ ‡é¢˜+ç®€ä»‹å¯é€‰ï¼‰
        // è¯´æ˜ï¼šæ˜¯å¦åŒ…å«ç®€ä»‹ç”±å…¨å±€å¼€å…³ window.__includeDesc æ§åˆ¶ï¼ˆé»˜è®¤ trueï¼‰
        function filterCards(q){
          var cards = $$('.card');
          var visible = 0; q = (q||'').trim().toLowerCase();
          var includeDesc = (typeof window !== 'undefined' && typeof window.__includeDesc === 'boolean') ? window.__includeDesc : true; // æ–°å¢ï¼šæ˜¯å¦åœ¨æœç´¢ä¸­åŒ…å«ç®€ä»‹
          var selectedTags = window.__selectedTags || [];

          function highlight(el, originText, query){
            if (!el) return;
            // ä»…å¯¹æ–‡æœ¬è¿›è¡Œé«˜äº®ï¼Œé¿å…æ±¡æŸ“å±æ€§ï¼ˆå¦‚ hrefï¼‰
            if (!el.dataset.origin) {
              el.dataset.origin = (originText || el.textContent || '').trim();
            }
            var text = el.dataset.origin || '';
            if (!query) { el.textContent = text; return; }
            try {
              var safe = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
              var re = new RegExp('(' + safe + ')', 'ig');
              var html = text.replace(re, '<mark style="background:#3e5bd4;color:#fff;border-radius:3px;padding:0 2px">$1</mark>');
              el.innerHTML = html;
            } catch(e){ el.textContent = text; }
          }

          cards.forEach(function(card){
            var title = (card.dataset.title || '').toLowerCase();
            var desc = (card.dataset.desc || '').toLowerCase();
            var cardTagsStr = (card.dataset.tags || '');

            // å‘½ä¸­è§„åˆ™ï¼šæ ‡é¢˜å‘½ä¸­ æˆ–ï¼ˆå¯ç”¨æ—¶ï¼‰ç®€ä»‹å‘½ä¸­
            var textHit = (!q || title.indexOf(q) >= 0 || (includeDesc && desc.indexOf(q) >= 0));
            
            // æ ‡ç­¾åŒ¹é…ï¼šåªè¦åŒ…å«ä»»ä¸€é€‰ä¸­çš„æ ‡ç­¾å³å¯ (ORé€»è¾‘)
            // å¦‚æœå¸Œæœ›æ˜¯ AND (å¿…é¡»åŒ…å«æ‰€æœ‰é€‰ä¸­æ ‡ç­¾)ï¼Œåˆ™æ”¹ä¸º every
            var tagHit = true;
            if (selectedTags.length > 0) {
              var cardTagList = cardTagsStr.split(',');
              tagHit = selectedTags.every(function(t) { return cardTagList.includes(t); });
            }

            var hit = textHit && tagHit;

            // ä»…é«˜äº®æ ‡é¢˜å¯è§æ–‡æœ¬ï¼Œé¿å…ç ´å <a href>
            highlight($('.title-link', card), card.dataset.title || '', q);
            // ç®€ä»‹é«˜äº®è·Ÿéš includeDescï¼Œæœªå¯ç”¨æ—¶æ¸…é™¤ç®€ä»‹é«˜äº®ï¼Œé¿å…è¯¯å¯¼
            if (includeDesc) {
              highlight($('.desc', card), card.dataset.desc || '', q);
            } else {
              highlight($('.desc', card), card.dataset.desc || '', '');
            }
            card.style.display = hit ? '' : 'none';
            if (hit) visible++;
          });
          stats.textContent = (q ? ('åŒ¹é… ' + visible + ' é¡¹') : ('å…± ' + cards.length + ' é¡¹')) + ' Â· å¯è§ï¼š' + visible;
        }

        function sortCards(order){
          var cards = $$('.card');
          var nodes = cards.map(function(c){ return { node: c, key: (c.dataset.title||'').toLowerCase() }; });
          nodes.sort(function(a,b){ return a.key.localeCompare(b.key, 'zh-Hans-CN'); });
          if (order === 'name-desc') nodes.reverse();
          var frag = document.createDocumentFragment();
          nodes.forEach(function(it){ frag.appendChild(it.node); });
          var columns = document.getElementById('columns');
          if (columns) columns.appendChild(frag);
        }

        // å¿«æ·é”®ï¼šæŒ‰ / èšç„¦æœç´¢ï¼ŒEsc æ¸…ç©º
        // å…¨å±€é”®ç›˜è¾“å…¥å³æœç´¢ï¼ˆæ— éœ€å…ˆç‚¹åˆ°è¾“å…¥æ¡†ï¼‰
        (function(){
          var lastTypeTime = 0; // è¿ç»­è¾“å…¥é—´éš”é˜ˆå€¼æ§åˆ¶
          var typeGapMs = 800;
          var composing = false;

          function isEditable(el){
            if (!el) return false;
            var tag = (el.tagName || '').toLowerCase();
            if (tag === 'input' || tag === 'textarea' || tag === 'select') return true;
            if (el.isContentEditable) return true;
            return false;
          }

          document.addEventListener('compositionstart', function(){ composing = true; }, true);
          document.addEventListener('compositionend', function(e){
            var target = document.activeElement;
            // è‹¥å½“å‰ä¸åœ¨æœç´¢æ¡†ç¼–è¾‘ï¼Œåˆæˆè¾“å…¥ç»“æŸæ—¶å°†æ–‡æœ¬å†™å…¥æœç´¢æ¡†
            if (composing && target !== search && !isEditable(target)) {
              var now = Date.now();
              if (now - lastTypeTime > typeGapMs) { search.value = ''; }
              var data = (e && e.data) ? e.data : '';
              if (data) {
                search.value += data;
                filterCards(search.value);
              }
              search.focus();
              lastTypeTime = now;
            }
            composing = false;
          }, true);

          document.addEventListener('keydown', function(ev) {
            // å¿«æ·é”®ï¼š/ èšç„¦æœç´¢
            if (ev.key === '/' && document.activeElement !== search) { ev.preventDefault(); search.focus(); return; }

            // Escï¼šèšç„¦/å–æ¶ˆ
            if (ev.key === 'Escape') { 
              if (document.activeElement === search) {
                // å¦‚æœå½“å‰æ˜¯èšç„¦çŠ¶æ€ï¼šå–æ¶ˆèšç„¦ (Blur)ï¼Œä¸æ¸…ç©º
                search.blur(); 
              } else {
                // å¦‚æœå½“å‰ä¸æ˜¯èšç„¦çŠ¶æ€ï¼šèšç„¦å¹¶å…¨é€‰ï¼Œæ–¹ä¾¿è¾“å…¥
                ev.preventDefault();
                search.focus();
                search.select();
              }
              return; 
            }

            // ä»…åœ¨éè¾“å…¥æ€ã€éç»„åˆé”®ã€éIMEåˆæˆæ—¶å¤„ç†
            if (isEditable(document.activeElement) || ev.ctrlKey || ev.metaKey || ev.altKey || composing) return;

            // Backspaceï¼šå…¨å±€åˆ é™¤ä¸€ä¸ªå­—ç¬¦
            if (ev.key === 'Backspace') {
              if (search.value) {
                ev.preventDefault();
                search.value = search.value.slice(0, -1);
                filterCards(search.value);
              }
              return;
            }

            // ä»…å¤„ç†å¯æ‰“å°å­—ç¬¦ï¼ˆé•¿åº¦ä¸º1ï¼‰
            if (typeof ev.key === 'string' && ev.key.length === 1) {
              var now = Date.now();
              if (now - lastTypeTime > typeGapMs) { search.value = ''; }
              search.value += ev.key;
              search.focus();
              filterCards(search.value);
              lastTypeTime = now;
              // é¿å…æµè§ˆå™¨é»˜è®¤è¡Œä¸ºï¼ˆä¾‹å¦‚é¡µé¢æ»šåŠ¨ç­‰ï¼‰
              ev.preventDefault();
              return;
            }
          }, true);
        })();
        // è¾“å…¥é˜²æŠ–
        var tId; search.addEventListener('input', function(){ clearTimeout(tId); tId=setTimeout(function(){ filterCards(search.value); }, 100); });
        if (sortSel) sortSel.addEventListener('change', function(){ sortCards(sortSel.value); filterCards(search.value); });

        // é¦–æ¬¡å¢å¼º + åˆå§‹åŒ–ç»Ÿè®¡
        enhanceCards();
        if (sortSel) sortCards(sortSel.value);
        filterCards('');
        // æ³¨æ„ï¼šopenLinkMode, columnWidth, backTop ç”± common.js åˆå§‹åŒ–

        // --- é”®ç›˜å¯¼èˆªåŠŸèƒ½ (2025-01-20) ---
        (function() {
          function getVisibleCards() {
            return Array.from(document.querySelectorAll('.card')).filter(function(c){
              return c.style.display !== 'none';
            });
          }

          function updateHighlight(card) {
            var all = document.querySelectorAll('.card');
            all.forEach(function(c){ c.classList.remove('card-highlight'); });
            if (card) {
              card.classList.add('card-highlight');
              // å¹³æ»‘æ»šåŠ¨å¯èƒ½å¯¼è‡´è¿ç»­æŒ‰é”®æ—¶ä½“éªŒä¸ä½³ï¼Œä½¿ç”¨ auto
              if (card.scrollIntoView) {
                card.scrollIntoView({ block: 'nearest', inline: 'nearest' });
              }
            }
          }

          function findNextCard(current, dir) {
            var visible = getVisibleCards();
            if (visible.length === 0) return null;
            if (!current) return visible[0];

            var rect = current.getBoundingClientRect();
            var cx = rect.left + rect.width / 2;
            var cy = rect.top + rect.height / 2;

            var best = null;
            var minDist = Infinity;

            visible.forEach(function(card) {
              if (card === current) return;
              var r = card.getBoundingClientRect();
              var tcx = r.left + r.width / 2;
              var tcy = r.top + r.height / 2;
              
              var dx = tcx - cx;
              var dy = tcy - cy;
              
              var valid = false;
              // å®½æ¾çš„æ–¹å‘åˆ¤å®š (é˜ˆå€¼ 5px)
              if (dir === 'up')    { if (dy < -5) valid = true; }
              else if (dir === 'down')  { if (dy > 5) valid = true; }
              else if (dir === 'left')  { if (dx < -5) valid = true; }
              else if (dir === 'right') { if (dx > 5) valid = true; }

              if (valid) {
                // è·ç¦»æƒé‡ï¼šä¸»æ–¹å‘å·®å¼‚å°ä¼˜å…ˆï¼Œæ¬¡æ–¹å‘å·®å¼‚å¤§æƒ©ç½š
                var dist = 0;
                if (dir === 'up' || dir === 'down') {
                  // å‚ç›´ç§»åŠ¨ï¼šæ°´å¹³åå·®æƒ©ç½šå¤§ (æƒé‡ 10)
                  dist = (dy * dy) + (dx * dx * 10);
                } else {
                  // æ°´å¹³ç§»åŠ¨ï¼šå‚ç›´åå·®æƒ©ç½šå¤§ (æƒé‡ 10)
                  dist = (dx * dx) + (dy * dy * 10);
                }

                if (dist < minDist) {
                  minDist = dist;
                  best = card;
                }
              }
            });

            return best || current;
          }

          // æœç´¢æ¡†å›è½¦ï¼šé«˜äº®ç¬¬ä¸€ä¸ªå¹¶ Blur
          search.addEventListener('keydown', function(ev) {
            if (ev.key === 'Enter') {
              ev.preventDefault();
              ev.stopPropagation(); // é˜»æ­¢å†’æ³¡ï¼Œé˜²æ­¢è§¦å‘å…¨å±€çš„ Enter è·³è½¬é€»è¾‘
              var visible = getVisibleCards();
              if (visible.length > 0) {
                updateHighlight(visible[0]);
                search.blur();
              }
            }
          });

          // å…¨å±€å¯¼èˆª
          document.addEventListener('keydown', function(ev) {
            // æœç´¢æ¡†èšç„¦æ—¶ï¼Œä¸å¤„ç†æ–¹å‘é”®ï¼Œé¿å…å†²çª
            if (document.activeElement === search) return;
            
            // å¿½ç•¥ä¿®é¥°é”®
            if (ev.ctrlKey || ev.metaKey || ev.altKey) return;

            var dir = null;
            if (ev.key === 'ArrowUp') dir = 'up';
            else if (ev.key === 'ArrowDown') dir = 'down';
            else if (ev.key === 'ArrowLeft') dir = 'left';
            else if (ev.key === 'ArrowRight') dir = 'right';

            if (dir) {
              ev.preventDefault();
              var current = document.querySelector('.card.card-highlight');
              // å¦‚æœå½“å‰æ²¡æœ‰é«˜äº®ï¼Œæˆ–è€…é«˜äº®çš„è¢«éšè—äº†ï¼Œé€‰ä¸­ç¬¬ä¸€ä¸ªå¯è§çš„
              if (!current || current.style.display === 'none') {
                var visible = getVisibleCards();
                if (visible.length > 0) updateHighlight(visible[0]);
              } else {
                var next = findNextCard(current, dir);
                updateHighlight(next);
              }
              return;
            }

            if (ev.key === 'Enter') {
              var current = document.querySelector('.card.card-highlight');
              if (current && current.style.display !== 'none') {
                var link = current.querySelector('.title-link');
                if (link) {
                   link.click(); 
                }
              }
            }
          });
        })();

        // æš´éœ²å…¨å±€ APIï¼Œä¾¿äºç‹¬ç«‹è„šæœ¬åŸºäº URL å‚æ•°è§¦å‘æœç´¢/è·³è½¬
        // - __navFilterCards(q: string): è§¦å‘ç­›é€‰å¹¶åˆ·æ–°é«˜äº®/ç»Ÿè®¡
        // - __includeDesc: æ˜¯å¦åœ¨æœç´¢ä¸­åŒ…å«ç®€ä»‹ï¼ˆé»˜è®¤ trueï¼Œå¯ç”±å¤–éƒ¨è„šæœ¬åˆ‡æ¢ï¼‰
        try {
          window.__navFilterCards = filterCards;
          if (typeof window.__includeDesc !== 'boolean') {
            window.__includeDesc = true; // é»˜è®¤åŒ…å«ç®€ä»‹å‚ä¸æœç´¢
          }
        } catch (e) { /* ignore */ }

      })();
    </script>
    <!-- åŸºäº URL å‚æ•°çš„è‡ªåŠ¨æœç´¢ä¸å•ç»“æœè·³è½¬ï¼ˆç‹¬ç«‹ç»´æŠ¤ï¼‰ -->
    <script defer src="assets/nav-query.js"></script>
    <!-- TAG_DATA -->
    <script src="assets/tags.js"></script>
  </body>
  </html>
