<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Chrome 扩展开发速查</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../assets/variables.css">
    <link rel="stylesheet" href="../../assets/global.css">
  <link rel="stylesheet" href="../../assets/cheatsheet.css">
    <style>
        :root {
            --col-width: 360px;
            --gap: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        table td, table th {
            border-top: 1px solid rgba(255,255,255,0.12);
            padding: 4px 6px;
        }
        table th {
            font-weight: 600;
            text-align: left;
            font-size: 0.86rem;
            color: rgba(255,255,255,0.7);
        }
    </style>

    <link rel="icon" type="image/png" href="../../assets/brand/cheatsheet.png" />
    <link rel="apple-touch-icon" href="../../assets/brand/cheatsheet.png" />
  </head>
<body>
    <div class="container">
        <div class="panel">
            <span style="color:#94e4ff;font-size:16px;margin-right:auto;">Chrome 扩展开发速查</span>
            <label for="columnWidth">调整每列宽度</label>
            <input id="columnWidth" class="slider-bar" type="range" min="300" max="660" value="360">
            <span id="widthVal" class="slider-val">360px</span>
        </div>
        <div class="cheat-columns" id="columns">
            <div class="card">
                <h2>Manifest 结构速览 <a href="https://developer.chrome.com/docs/extensions/reference/manifest?hl=zh-cn" title="Manifest 键参考" target="_blank" style="color:#93cdfc;">键清单</a></h2>
                <table>
                    <tr><th>键</th><th>说明</th></tr>
                    <tr><td>manifest_version</td><td>唯一支持值为 3，开启 MV3 事件驱动与安全沙箱。</td></tr>
                    <tr><td>name/version/description</td><td>在Chrome商店与扩展管理页展示；name 限 75 字，description 限 132 字，建议配合 default_locale 进行国际化。</td></tr>
                    <tr><td>icons</td><td>至少提供 48px 与 128px，供工具栏、Chrome Web Store 及扩展页使用。</td></tr>
                    <tr><td>action/background/service_worker</td><td>定义工具栏入口与后台事件逻辑；MV3 仅支持 service_worker，persistent 无效。</td></tr>
                    <tr><td>permissions / host_permissions</td><td>permissions 关联 API 权限（如 tabs/storage），host_permissions 定义可访问的 URL 匹配；建议使用 optional_* 逐步请求。</td></tr>
                    <tr><td>content_scripts / web_accessible_resources</td><td>声明注入脚本与可被网页读取的资源，需同时提供 matches、js/css 与 run_at。</td></tr>
                    <tr><td>cross_origin_embedder_policy / cross_origin_opener_policy</td><td>设置 COEP/COOP（credentialless/same-origin）以启用 SharedArrayBuffer 与跨源通信。</td></tr>
                    <tr><td>declarative_net_request</td><td>静态规则描述，traceable 但性能友好；可搭配 dynamic_rules 实现运行期更新。</td></tr>
                </table>
                <pre><code class="language-json">{
  "manifest_version": 3,
  "name": "Chrome 扩展速查",
  "version": "1.0",
  "description": "界面、网络与通信指南",
  "icons": {
    "16": "images/icon-16.png",
    "48": "images/icon-48.png",
    "128": "images/icon-128.png"
  },
  "action": { "default_popup": "popup.html" },
  "background": { "service_worker": "service-worker.js" },
  "permissions": ["storage", "tabs", "scripting"],
  "host_permissions": ["https://*.example.com/*"],
  "content_scripts": [
    {
      "matches": ["https://*.example.com/*"],
      "js": ["content.js"],
      "run_at": "document_idle"
    }
  ]
}</code></pre>
            </div>
            <div class="card">
                <h2>Service Worker / 生命周期</h2>
                <ul>
                    <li><code>chrome.runtime.onInstalled</code> 处理首次安装、本地数据迁移与版本升级提示；搭配 <code>runtime.setUninstallURL</code> 可收集反馈。</li>
                    <li><code>chrome.runtime.onStartup</code> 在用户打开 Chrome 时唤醒，可校验同步配置或调用 API 拉取更新。</li>
                    <li><code>chrome.runtime.onSuspend</code> 发生在 Service Worker 闲置前，需快速清理定时器并保存必要状态。</li>
                    <li><code>chrome.alarms</code> 是唤醒 Service Worker 的可靠方式；建议与 <code>chrome.alarms.get</code> 校验重复任务。</li>
                    <li>避免在 Service Worker 中直接操作 DOM；需 UI 时迁移至 popup/sidePanel 或通过 Offscreen Document。</li>
                </ul>
            </div>
            <div class="card">
                <h2>界面入口与交互</h2>
                <ul>
                    <li><code>chrome.action</code> 控制工具栏图标、徽章、popup；结合 <code>setBadgeText</code> 与 <code>setIcon</code> 提示状态。</li>
                    <li>Popup/Options/DevTools Panel/Sidebar 为 HTML 页面，建议复用样式变量并使用 <code>template</code> 组件提升维护性。</li>
                    <li><code>chrome.sidePanel</code> 适用于旁栏常驻内容，重点是保持页面轻量与可滚动；使用 <code>default_path</code> 指向静态页面。</li>
                    <li><code>chrome.contextMenus</code> 与 <code>chrome.commands</code> 为场景提供快捷入口，事件回调中可调用 <code>chrome.runtime.sendMessage</code> 触发后端逻辑。</li>
                    <li>Popup 与 Content Script 之间的消息通信必须通过 <code>chrome.runtime.sendMessage</code>/<code>chrome.tabs.sendMessage</code>，避免直接访问 DOM。</li>
                </ul>
            </div>
            <div class="card">
                <h2>浏览器与网络控制</h2>
                <ul>
                    <li><code>chrome.tabs</code> 提供 query/create/update/remove/duplicate，`captureVisibleTab` 可截图；`scripting.executeScript` 替代已废弃的 `tabs.executeScript`。</li>
                    <li><code>chrome.windows</code> 用于创建、聚焦、同步窗口状态；<code>chrome.sessions</code> 支持会话恢复。</li>
                    <li>内容脚本与 <code>scripting.executeScript</code> 配合：通过 `matches` + `run_at` 控制代码注入时机，`world` 可设置为 ISOLATED 或 MAIN。</li>
                    <li><code>declarativeNetRequest</code> 用于静态/动态规则过滤；仅在必须时再申请 `webRequest` 权限。</li>
                    <li><code>chrome.contentSettings</code> 与 <code>chrome.cookies</code> 管控 Cookie/JavaScript/弹窗等行为；<code>chrome.proxy</code> 辅助重写网络策略。</li>
                </ul>
            </div>
            <div class="card">
                <h2>权限与安全 <a href="https://developer.chrome.com/docs/extensions/reference/permissions-list?hl=zh-cn" title="权限警告" target="_blank" style="color:#93cdfc;">权限警告</a></h2>
                <ul>
                    <li><code>permissions</code> 定义可访问的 API，<code>host_permissions</code> 控制 Web 请求范围；在 Manifest 中将高风险权限分组并尽量交给 optional_permissions 请求。</li>
                    <li>部分权限会触发警告：如 <code>cookies</code>、<code>history</code>、<code>tabs</code>（读取浏览记录）、<code>declarativeNetRequest</code>（屏蔽所有页面）、<code>proxy</code>、<code>webRequestBlocking</code>。</li>
                    <li><code>activeTab</code> 通过点击等用户手势临时授予当前标签页访问权限，是减少权限的首选。</li>
                    <li>MV3 禁止 <code>eval</code> 与 remote code，所有脚本需打包并使用 CSP；建议设置 `content_security_policy` 严格模式。</li>
                    <li>配置 COOP/COEP（credentialless/same-origin） + Offscreen Document，解决 Service Worker 无 DOM 的限制。</li>
                </ul>
            </div>
            <div class="card">
                <h2>存储、通信与调试</h2>
                <ul>
                    <li>Storage：`sync`（跨设备）、`local`（本地）、`managed`（企业）、`session`（标签页生命周期）；`chrome.storage.onChanged` 实时监听。</li>
                    <li>消息机制：Popup、Content Script、Service Worker 通过 `runtime.sendMessage`/`tabs.sendMessage`、`runtime.connect` 与 `Port` 互通；推荐在 background 中缓存 listener。</li>
                    <li><code>chrome.commands` 快捷键可直接在 Service Worker 中触发 `scripting.executeScript` 或写入 `storage.session`。</li>
                    <li>调试手段：开启 `chrome://extensions` 开发者模式，使用 `service_worker` 控制台、`chrome://inspect/#service-worker` 追踪事件。</li>
                    <li><code>chrome.runtime.onUpdateAvailable` 与 `chrome.runtime.reload` 组合实现更新推送；`chrome.runtime.getPlatformInfo` 辅助多平台提示。</li>
                </ul>
            </div>
        </div>
    </div>
    <script src="../../assets/common.js"></script>
</body>
</html>
