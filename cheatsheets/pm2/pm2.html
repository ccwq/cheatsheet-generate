<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>PM2 è¿›ç¨‹ç®¡ç†é€ŸæŸ¥è¡¨</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../css/variables.css">
    <link rel="stylesheet" href="../../css/common.css">
    <style>
        :root {
            --col-width: 400px;
            --gap: 16px;
        }

        .panel label {
            color: var(--panel-accent);
        }

        .panel .title {
            color: var(--panel-accent);
        }
    </style>

    <link rel="icon" type="image/png" href="../../assets/brand/cheatsheet.png" />
    <link rel="apple-touch-icon" href="../../assets/brand/cheatsheet.png" />
  </head>
<body>
    <div class="container">
        <div class="panel">
            <span style="color:#7bfbb7;font-size:16px;margin-right:auto;">PM2 è¿›ç¨‹ç®¡ç†é€ŸæŸ¥è¡¨</span>
            <label for="columnWidth">ğŸ”§ è°ƒæ•´æ¯åˆ—å®½åº¦ï¼š</label>
            <input id="columnWidth" class="slider-bar" type="range" min="300" max="660" value="340">
            <span id="widthVal" class="slider-val">340px</span>
        </div>
        <div class="cheat-columns" id="columns">
            <!-- å®‰è£… -->
            <div class="card">
                <h2>ğŸ“¦ å®‰è£… <a href="https://pm2.keymetrics.io/docs/usage/quick-start/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ é€šè¿‡ NPM å®‰è£…</h3>
                <pre><span class="comment"># å®‰è£…æœ€æ–°ç‰ˆæœ¬</span>
npm install pm2@latest -g

<span class="comment"># é€šè¿‡ Yarn å®‰è£…</span>
yarn global add pm2</pre>

                <h3>ğŸ” æ£€æŸ¥ç‰ˆæœ¬</h3>
                <pre>pm2 -v
pm2 --version</pre>

                <div class="tip">
                    ğŸ’¡ éœ€è¦ Node.js å’Œ NPM ç¯å¢ƒï¼Œå¯ä½¿ç”¨ NVM ç®¡ç† Node ç‰ˆæœ¬
                </div>
            </div>

            <!-- å¯åŠ¨åº”ç”¨ -->
            <div class="card">
                <h2>ğŸš€ å¯åŠ¨åº”ç”¨ <a href="https://pm2.keymetrics.io/docs/usage/quick-start/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ åŸºæœ¬å¯åŠ¨</h3>
                <pre><span class="comment"># å¯åŠ¨ Node.js åº”ç”¨</span>
pm2 start app.js

<span class="comment"># å¯åŠ¨è„šæœ¬æ–‡ä»¶</span>
pm2 start bashscript.sh

<span class="comment"># ç›‘è§†æ¨¡å¼å¯åŠ¨</span>
pm2 start python-app.py --watch

<span class="comment"># å¯åŠ¨äºŒè¿›åˆ¶æ–‡ä»¶å¹¶ä¼ é€’å‚æ•°</span>
pm2 start binary-file -- --port 1520</pre>

                <h3>âš™ï¸ å¯åŠ¨é€‰é¡¹</h3>
                <pre>pm2 start app.js --name <span class="string">&lt;app_name&gt;</span>
pm2 start app.js --watch
pm2 start app.js --max-memory-restart 200MB
pm2 start app.js --log <span class="string">&lt;log_path&gt;</span>
pm2 start app.js -- arg1 arg2 arg3
pm2 start app.js --restart-delay <span class="string">&lt;delay_ms&gt;</span>
pm2 start app.js --time
pm2 start app.js --no-autorestart
pm2 start app.js --cron <span class="string">&lt;cron_pattern&gt;</span>
pm2 start app.js --no-daemon</pre>

                <div class="desc">
                    --name: æŒ‡å®šåº”ç”¨åç§° | --watch: æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡å¯ | --max-memory-restart: å†…å­˜è¶…é™é‡å¯
                </div>
            </div>

            <!-- è¿›ç¨‹ç®¡ç† -->
            <div class="card">
                <h2>âš™ï¸ è¿›ç¨‹ç®¡ç† <a href="https://pm2.keymetrics.io/docs/usage/process-management/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ”„ åŸºæœ¬æ“ä½œ</h3>
                <pre><span class="comment"># æŒ‰åç§°æ“ä½œ</span>
pm2 restart app_name
pm2 reload app_name
pm2 stop app_name
pm2 delete app_name

<span class="comment"># æŒ‰è¿›ç¨‹ ID æ“ä½œ</span>
pm2 restart 0
pm2 stop 0
pm2 delete 0</pre>

                <h3>ğŸ“¦ æ‰¹é‡æ“ä½œ</h3>
                <pre>pm2 restart all
pm2 reload all
pm2 stop all
pm2 delete all</pre>

                <div class="warning">
                    âš ï¸ reload ç”¨äºç½‘ç»œåº”ç”¨å¯å®ç°é›¶åœæœºé‡å¯ï¼Œå…¶ä»–ç±»å‹åº”ç”¨è¯·ä½¿ç”¨ restart
                </div>
            </div>

            <!-- çŠ¶æ€æŸ¥çœ‹ -->
            <div class="card">
                <h2>ğŸ“Š çŠ¶æ€æŸ¥çœ‹ <a href="https://pm2.keymetrics.io/docs/usage/process-management/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ è¿›ç¨‹åˆ—è¡¨</h3>
                <pre>pm2 list
pm2 ls
pm2 status</pre>

                <h3>ğŸ“ è¯¦ç»†ä¿¡æ¯</h3>
                <pre>pm2 describe 0
pm2 show app_name
pm2 info app_name</pre>

                <h3>ğŸ“Š JSON è¾“å‡º</h3>
                <pre>pm2 jlist
pm2 prettylist</pre>

                <h3>ğŸ“ˆ å®æ—¶ç›‘æ§</h3>
                <pre>pm2 monit</pre>

                <div class="tip">
                    ğŸ’¡ monit æä¾›ç»ˆç«¯å®æ—¶ç›‘æ§é¢æ¿ï¼Œæ˜¾ç¤º CPUã€å†…å­˜ç­‰æŒ‡æ ‡
                </div>
            </div>

            <!-- æ—¥å¿—ç®¡ç† -->
            <div class="card">
                <h2>ğŸ“ æ—¥å¿—ç®¡ç† <a href="https://pm2.keymetrics.io/docs/usage/log-management/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ æŸ¥çœ‹æ—¥å¿—</h3>
                <pre><span class="comment"># å®æ—¶æ˜¾ç¤ºæ—¥å¿—</span>
pm2 logs

<span class="comment"># æŸ¥çœ‹æŒ‡å®šåº”ç”¨æ—¥å¿—</span>
pm2 logs app_name

<span class="comment"># æ˜¾ç¤ºæœ€è¿‘ N è¡Œ</span>
pm2 logs --lines 200

<span class="comment"># åŸå§‹æ—¥å¿—è¾“å‡º</span>
pm2 logs --raw

<span class="comment"># åªæ˜¾ç¤ºé”™è¯¯æ—¥å¿—</span>
pm2 logs --err</pre>

                <h3>ğŸ§¹ æ—¥å¿—æ¸…ç†</h3>
                <pre><span class="comment"># æ¸…ç©ºæ‰€æœ‰æ—¥å¿—</span>
pm2 flush

<span class="comment"># é‡è½½æ—¥å¿—</span>
pm2 reloadLogs</pre>

                <h3>ğŸ”„ æ—¥å¿—è½®è½¬</h3>
                <pre><span class="comment"># å®‰è£…æ—¥å¿—è½®è½¬æ¨¡å—</span>
pm2 install pm2-logrotate

<span class="comment"># é…ç½®å‚æ•°</span>
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7
pm2 set pm2-logrotate:compress true</pre>
            </div>

            <!-- Cluster é›†ç¾¤æ¨¡å¼ -->
            <div class="card">
                <h2>ğŸ”— Cluster é›†ç¾¤æ¨¡å¼ <a href="https://pm2.keymetrics.io/docs/usage/cluster-mode/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸš€ å¯åŠ¨é›†ç¾¤</h3>
                <pre><span class="comment"># æœ€å¤§è¿›ç¨‹æ•°ï¼ˆæ ¹æ® CPU æ ¸å¿ƒæ•°ï¼‰</span>
pm2 start app.js -i max

<span class="comment"># æŒ‡å®šè¿›ç¨‹æ•°é‡</span>
pm2 start app.js -i 4

<span class="comment"># Fork æ¨¡å¼ï¼ˆå•è¿›ç¨‹ï¼‰</span>
pm2 start app.js -i 0</pre>

                <h3>ğŸ“Š æ‰©å®¹ç¼©å®¹</h3>
                <pre><span class="comment"># å¢åŠ è¿›ç¨‹</span>
pm2 scale app +3

<span class="comment"># è®¾ç½®å›ºå®šè¿›ç¨‹æ•°</span>
pm2 scale app 2</pre>

                <div class="tip">
                    ğŸ’¡ é›†ç¾¤æ¨¡å¼è‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼Œé€‚åˆå¤šæ ¸ CPU æœåŠ¡å™¨
                </div>
            </div>

            <!-- ç”Ÿæ€ç³»ç»Ÿé…ç½® -->
            <div class="card">
                <h2>ğŸ“ ç”Ÿæ€ç³»ç»Ÿé…ç½® <a href="https://pm2.keymetrics.io/docs/usage/application-declaration/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ ç”Ÿæˆé…ç½®æ–‡ä»¶</h3>
                <pre>pm2 ecosystem</pre>

                <h3>ğŸš€ ä½¿ç”¨é…ç½®å¯åŠ¨</h3>
                <pre>pm2 start ecosystem.config.js</pre>

                <h3>âš™ï¸ é…ç½®ç¤ºä¾‹</h3>
                <pre>module.exports = {
  apps: [{
    name: <span class="string">"app"</span>,
    script: <span class="string">"./app.js"</span>,
    instances: <span class="string">"max"</span>,
    exec_mode: <span class="string">"cluster"</span>,
    env: {
      NODE_ENV: <span class="string">"development"</span>,
      PORT: <span class="number">3000</span>
    },
    env_production: {
      NODE_ENV: <span class="string">"production"</span>,
      PORT: <span class="number">8080</span>
    },
    watch: <span class="keyword">true</span>,
    ignore_watch: [<span class="string">"node_modules"</span>, <span class="string">"logs"</span>],
    max_memory_restart: <span class="string">"500M"</span>,
    log_date_format: <span class="string">"YYYY-MM-DD HH:mm:ss"</span>
  }]
};</pre>

                <div class="desc">
                    é…ç½®æ–‡ä»¶æ”¯æŒç®¡ç†å¤šä¸ªåº”ç”¨ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
                </div>
            </div>

            <!-- å¼€æœºè‡ªå¯åŠ¨ -->
            <div class="card">
                <h2>ğŸ”„ å¼€æœºè‡ªå¯åŠ¨ <a href="https://pm2.keymetrics.io/docs/usage/startup/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ è®¾ç½®å¼€æœºå¯åŠ¨</h3>
                <pre><span class="comment"># ç”Ÿæˆå¯åŠ¨è„šæœ¬</span>
pm2 startup

<span class="comment"># ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨</span>
pm2 save</pre>

                <h3>ğŸš« ç¦ç”¨å¼€æœºå¯åŠ¨</h3>
                <pre>pm2 unstartup</pre>

                <div class="tip">
                    ğŸ’¡ æœåŠ¡å™¨é‡å¯åï¼ŒPM2 ä¼šè‡ªåŠ¨æ¢å¤ä¿å­˜çš„è¿›ç¨‹åˆ—è¡¨
                </div>
            </div>

            <!-- æ–‡ä»¶ç›‘å¬ -->
            <div class="card">
                <h2>ğŸ‘ï¸ æ–‡ä»¶ç›‘å¬ <a href="https://pm2.keymetrics.io/docs/usage/watch-and-restart/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ å¯åŠ¨ç›‘å¬</h3>
                <pre><span class="comment"># å¯åŠ¨æ–‡ä»¶ç›‘è§†</span>
pm2 start app.js --watch

<span class="comment"># å¿½ç•¥ç‰¹å®šç›®å½•</span>
pm2 start app.js --watch --ignore-watch=<span class="string">"node_modules"</span>

<span class="comment"># å¿½ç•¥å¤šä¸ªç›®å½•</span>
pm2 start app.js --watch --ignore-watch=<span class="string">"node_modules,logs,tmp"</span></pre>

                <h3>âš™ï¸ é…ç½®æ–‡ä»¶æ–¹å¼</h3>
                <pre>module.exports = {
  apps: [{
    name: <span class="string">"app"</span>,
    script: <span class="string">"./app.js"</span>,
    watch: <span class="keyword">true</span>,
    ignore_watch: [<span class="string">"node_modules"</span>, <span class="string">"logs"</span>],
    watch_delay: <span class="number">1000</span>
  }]
};</pre>

                <div class="warning">
                    âš ï¸ æ–‡ä»¶ç›‘å¬é€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨é…ç½®æ–‡ä»¶
                </div>
            </div>

            <!-- æ›´æ–° PM2 -->
            <div class="card">
                <h2>ğŸ”„ æ›´æ–° PM2 <a href="https://pm2.keymetrics.io/docs/usage/update-pm2/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ æ›´æ–°æ­¥éª¤</h3>
                <pre><span class="comment"># å®‰è£…æœ€æ–°ç‰ˆæœ¬</span>
npm install pm2@latest -g

<span class="comment"># æ›´æ–°å†…å­˜ä¸­çš„ PM2</span>
pm2 update</pre>

                <h3>ğŸ” æ£€æŸ¥ç‰ˆæœ¬</h3>
                <pre>pm2 -v
pm2 --version</pre>

                <div class="tip">
                    ğŸ’¡ æ›´æ–° PM2 ä¸ä¼šå½±å“è¿è¡Œä¸­çš„åº”ç”¨ï¼Œä½†å»ºè®®åœ¨ç»´æŠ¤çª—å£è¿›è¡Œ
                </div>
            </div>

            <!-- å…¶ä»–å‘½ä»¤ -->
            <div class="card">
                <h2>ğŸ”§ å…¶ä»–å‘½ä»¤ <a href="https://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ å¸¸ç”¨å‘½ä»¤</h3>
                <pre><span class="comment"># é‡ç½®å…ƒæ•°æ®</span>
pm2 reset app_name

<span class="comment"># æ£€æŸ¥å®ˆæŠ¤è¿›ç¨‹çŠ¶æ€</span>
pm2 ping

<span class="comment"># å‘é€ç³»ç»Ÿä¿¡å·</span>
pm2 sendSignal SIGUSR2 my-app

<span class="comment"># æ‰“å¼€ PM2 Plus ç›‘æ§</span>
pm2 plus</pre>

                <h3>ğŸ” æ•…éšœæ’æŸ¥</h3>
                <pre><span class="comment"># æŸ¥çœ‹é”™è¯¯æ—¥å¿—</span>
pm2 logs --err

<span class="comment"># æŸ¥çœ‹ç‰¹å®šåº”ç”¨æ—¥å¿—</span>
pm2 logs app_name

<span class="comment"># æŸ¥çœ‹è¿›ç¨‹è¯¦ç»†ä¿¡æ¯</span>
pm2 describe app_name</pre>

                <div class="desc">
                    reset: é‡ç½®é‡å¯æ¬¡æ•°ç­‰å…ƒæ•°æ® | ping: ç¡®ä¿ PM2 å®ˆæŠ¤è¿›ç¨‹è¿è¡Œ
                </div>
            </div>

            <!-- ç¯å¢ƒå˜é‡ -->
            <div class="card">
                <h2>ğŸŒ ç¯å¢ƒå˜é‡ <a href="https://pm2.keymetrics.io/docs/usage/environment/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ å‘½ä»¤è¡Œæ–¹å¼</h3>
                <pre><span class="comment"># ä½¿ç”¨ç‰¹å®šç¯å¢ƒå¯åŠ¨</span>
pm2 start app.js --env production</pre>

                <h3>âš™ï¸ é…ç½®æ–‡ä»¶æ–¹å¼</h3>
                <pre>module.exports = {
  apps: [{
    name: <span class="string">"app"</span>,
    script: <span class="string">"./app.js"</span>,
    env: {
      NODE_ENV: <span class="string">"development"</span>,
      PORT: <span class="number">3000</span>
    },
    env_production: {
      NODE_ENV: <span class="string">"production"</span>,
      PORT: <span class="number">8080</span>
    },
    env_staging: {
      NODE_ENV: <span class="string">"staging"</span>,
      PORT: <span class="number">4000</span>
    }
  }]
};</pre>

                <h3>ğŸš€ å¯åŠ¨æŒ‡å®šç¯å¢ƒ</h3>
                <pre>pm2 start ecosystem.config.js --env production</pre>
            </div>

            <!-- è¿›ç¨‹ç›‘æ§é¢æ¿ -->
            <div class="card">
                <h2>ğŸ“ˆ ç›‘æ§é¢æ¿ <a href="https://pm2.keymetrics.io/docs/usage/monitoring/" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
                <h3>ğŸ“‹ ç»ˆç«¯ç›‘æ§</h3>
                <pre><span class="comment"># å®æ—¶ç›‘æ§é¢æ¿</span>
pm2 monit</pre>

                <h3>ğŸŒ Web ç›‘æ§</h3>
                <pre><span class="comment"># æ‰“å¼€ PM2 Plus ç›‘æ§</span>
pm2 plus</pre>

                <h3>ğŸ“Š ç›‘æ§æŒ‡æ ‡</h3>
                <ul>
                    <li><span class="highlight">CPU ä½¿ç”¨ç‡</span> - å®æ—¶ CPU å ç”¨</li>
                    <li><span class="highlight">å†…å­˜ä½¿ç”¨</span> - RSS å’Œå †å†…å­˜</li>
                    <li><span class="highlight">é‡å¯æ¬¡æ•°</span> - å¼‚å¸¸é‡å¯ç»Ÿè®¡</li>
                    <li><span class="highlight">è¿è¡Œæ—¶é—´</span> - è¿›ç¨‹è¿è¡Œæ—¶é•¿</li>
                    <li><span class="highlight">æ—¥å¿—è¾“å‡º</span> - å®æ—¶æ—¥å¿—æµ</li>
                </ul>

                <div class="tip">
                    ğŸ’¡ PM2 Plus æä¾›è·¨æœåŠ¡å™¨ç›‘æ§å’Œè¯Šæ–­ç³»ç»Ÿ
                </div>
            </div>

        </div>
    </div>
    <script src="../../assets/common.js"></script>
</body>
</html>