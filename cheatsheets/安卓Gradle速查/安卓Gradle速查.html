<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å®‰å“Gradleé€ŸæŸ¥å¼€å‘å‘½ä»¤é€ŸæŸ¥è¡¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- å¼•å…¥å…¬å…±CSSæ ·å¼ -->
  <link rel="stylesheet" href="../../assets/variables.css">
  <link rel="stylesheet" href="../../assets/global.css">
  <link rel="stylesheet" href="../../assets/cheatsheet.css">

  <style>
    /* å®‰å“Gradleé€ŸæŸ¥ç‰¹æœ‰çš„æ ·å¼è°ƒæ•´ */
    .cheat-columns {
      /* ä½¿ç”¨column-countå¸ƒå±€ */
      column-count: 4;
    }

    @media (max-width: 1500px) {
      .cheat-columns {
        column-count: 3;
      }
    }

    @media (max-width: 1100px) {
      .cheat-columns {
        column-count: 2;
      }
    }

    @media (max-width: 750px) {
      .cheat-columns {
        column-count: 1;
      }
    }

    .panel label {
      color: #ffe49b; /* ä¿æŒåŸæœ‰çš„labelé¢œè‰² */
    }

    .slider-bar {
      min-width: 120px; /* ä¿æŒåŸæœ‰çš„æ»‘å—å®½åº¦ */
    }

    .slider-val {
      min-width: 28px; /* ä¿æŒåŸæœ‰çš„å€¼æ˜¾ç¤ºå®½åº¦ */
    }
  </style>

    <link rel="icon" type="image/png" href="../../assets/brand/cheatsheet.png" />
    <link rel="apple-touch-icon" href="../../assets/brand/cheatsheet.png" />
  </head>
<body>
  <div class="container">
    <div class="panel">
      <span style="color:#7bfbb7;font-size:16px;margin-right:auto;">å®‰å“Gradleé€ŸæŸ¥é€ŸæŸ¥è¡¨</span>
<!-- META_INFO_START -->
<div class="meta-info">
  <span class="meta-item"><span class="meta-label">ç‰ˆæœ¬</span><span class="meta-value">unknown</span></span>
  <span class="meta-item"><span class="meta-label">æ›´æ–°æ—¥å¿—</span><span class="meta-value">2025-11-17</span></span>
  <span class="meta-item"><span class="meta-label">GitHub</span><span class="meta-value"><span class="meta-plain">unknown</span></span></span>
</div>
<!-- META_INFO_END -->

      <label for="columnWidth">ğŸ”§ è°ƒæ•´æ¯åˆ—å®½åº¦ï¼š</label>
      <input id="columnWidth" class="slider-bar" type="range" min="300" max="660" value="340">
      <span id="widthVal" class="slider-val">340px</span>
    </div>
    <div class="cheat-columns" id="columns">
      <!-- ç¯å¢ƒæ­å»ºä¸Wrapper -->
      <div class="card">
        <h2>ğŸ”§ ç¯å¢ƒæ­å»ºä¸Wrapper <a href="https://developer.android.com/build" title="å®˜æ–¹æ–‡æ¡£" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>å®‰è£…Gradle</h3>
        <pre>brew install gradle
gradle -v</pre>
        <h3>Gradle Wrapper</h3>
        <pre>gradle wrapper --gradle-version 8.0
./gradlew tasks</pre>
        <ul>
          <li><code>gradlew</code>ï¼šUnix/Linuxè„šæœ¬</li>
          <li><code>gradlew.bat</code>ï¼šWindowsæ‰¹å¤„ç†</li>
          <li><code>gradle/wrapper/</code>ï¼šWrapper Jarå’Œå±æ€§</li>
        </ul>
        <div class="desc">æ¨èä½¿ç”¨Wrapperä¿è¯å›¢é˜Ÿæ„å»ºç¯å¢ƒä¸€è‡´æ€§</div>
      </div>

      <!-- é¡¹ç›®é…ç½®åŸºç¡€ -->
      <div class="card">
        <h2>âš™ï¸ é¡¹ç›®é…ç½®åŸºç¡€ <a href="https://developer.android.com/build/android-build-structure" title="æ„å»ºç»“æ„" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>settings.gradle</h3>
        <pre>rootProject.name = "MyApp"
include ":app", ":core", ":data"</pre>
        <h3>gradle.properties</h3>
        <pre>org.gradle.jvmargs=-Xmx4g -XX:MaxMetaspaceSize=512m
org.gradle.parallel=true
org.gradle.caching=true
android.useAndroidX=true</pre>
        <h3>local.properties</h3>
        <pre>sdk.dir=/Users/username/Library/Android/sdk
ndk.dir=/Users/username/Library/Android/sdk/ndk/25.1.8937393</pre>
        <div class="desc">local.propertiesé€šå¸¸ä¸æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶</div>
      </div>

      <!-- æ„å»ºè„šæœ¬DSL -->
      <div class="card">
        <h2>ğŸ“ æ„å»ºè„šæœ¬DSL <a href="https://developer.android.com/studio/build" title="æ„å»ºé…ç½®" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>Groovy DSL</h3>
        <pre>android {
    compileSdk 34
    defaultConfig {
        applicationId "com.example.app"
        minSdk 21
        targetSdk 34
        versionCode 1
        versionName "1.0"
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }
}</pre>
        <h3>Kotlin DSL</h3>
        <pre>android {
    compileSdk = 34
    defaultConfig {
        applicationId = "com.example.app"
        minSdk = 21
        targetSdk = 34
        versionCode = 1
        versionName = "1.0"
    }
}</pre>
        <div class="desc">Kotlin DSLæä¾›æ›´å¥½çš„IDEæ”¯æŒå’Œç±»å‹å®‰å…¨</div>
      </div>

      <!-- æ’ä»¶åº”ç”¨ -->
      <div class="card">
        <h2>ğŸ”Œ æ’ä»¶åº”ç”¨ <a href="https://developer.android.com/studio/build/gradle-plugin" title="AGPæ’ä»¶" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>æ’ä»¶å£°æ˜</h3>
        <pre>// Groovy
plugins {
    id 'com.android.application' version '8.1.0'
    id 'kotlin-android' version '1.9.0'
}

// Kotlin DSL
plugins {
    id("com.android.application") version "8.1.0"
    kotlin("android") version "1.9.0"
}</pre>
        <h3>Legacyæ–¹å¼</h3>
        <pre>apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'</pre>
        <h3>æ’ä»¶ç±»å‹</h3>
        <ul>
          <li><code>com.android.application</code>ï¼šåº”ç”¨æ¨¡å—</li>
          <li><code>com.android.library</code>ï¼šåº“æ¨¡å—</li>
          <li><code>com.android.test</code>ï¼šæµ‹è¯•æ¨¡å—</li>
        </ul>
      </div>

      <!-- ä¾èµ–ç®¡ç† -->
      <div class="card">
        <h2>ğŸ“¦ ä¾èµ–ç®¡ç† <a href="https://developer.android.com/build/dependencies" title="ä¾èµ–é…ç½®" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>ä»“åº“é…ç½®</h3>
        <pre>repositories {
    google()
    mavenCentral()
    jcenter() // å·²åºŸå¼ƒ
}</pre>
        <h3>ä¾èµ–èŒƒå›´</h3>
        <ul>
          <li><code>implementation</code>ï¼šç¼–è¯‘æ—¶ä¾èµ–ï¼Œä¸æš´éœ²ç»™ä½¿ç”¨è€…</li>
          <li><code>api</code>ï¼šç¼–è¯‘æ—¶ä¾èµ–ï¼Œæš´éœ²ç»™ä½¿ç”¨è€…</li>
          <li><code>compileOnly</code>ï¼šä»…ç¼–è¯‘æ—¶ä½¿ç”¨</li>
          <li><code>runtimeOnly</code>ï¼šä»…è¿è¡Œæ—¶ä½¿ç”¨</li>
          <li><code>kapt</code> / <code>annotationProcessor</code>ï¼šæ³¨è§£å¤„ç†å™¨</li>
          <li><code>testImplementation</code>ï¼šæµ‹è¯•ä¾èµ–</li>
          <li><code>androidTestImplementation</code>ï¼šAndroidæµ‹è¯•ä¾èµ–</li>
        </ul>
        <div class="desc">ä½¿ç”¨implementationæé«˜ç¼–è¯‘æ€§èƒ½</div>
      </div>

      <!-- ä»»åŠ¡ç³»ç»Ÿ -->
      <div class="card">
        <h2>ğŸ¯ ä»»åŠ¡ç³»ç»Ÿ <a href="https://docs.gradle.org/current/userguide/tutorial_using_tasks.html" title="Gradleä»»åŠ¡" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>è‡ªå®šä¹‰ä»»åŠ¡</h3>
        <pre>task copyAssets(type: Copy) {
    from 'src/main/assets'
    into "$buildDir/outputs/assets"
    description 'Copy assets to build directory'
}

task cleanBuildDir(type: Delete) {
    delete rootProject.buildDir
}</pre>
        <h3>å¸¸ç”¨å‘½ä»¤</h3>
        <pre>./gradlew clean              # æ¸…ç†æ„å»º
./gradlew assembleDebug       # æ„å»ºDebugç‰ˆæœ¬
./gradlew assembleRelease     # æ„å»ºReleaseç‰ˆæœ¬
./gradlew installDebug        # å®‰è£…Debugç‰ˆæœ¬
./gradlew connectedAndroidTest # è¿è¡ŒUIæµ‹è¯•</pre>
        <h3>ä»»åŠ¡ä¾èµ–</h3>
        <pre>assembleDebug.dependsOn 'copyAssets'</pre>
      </div>

      <!-- ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ -->
      <div class="card">
        <h2>ğŸ”„ ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ <a href="https://docs.gradle.org/current/userguide/build_lifecycle.html" title="æ„å»ºç”Ÿå‘½å‘¨æœŸ" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>ä¸‰é˜¶æ®µ</h3>
        <ul>
          <li><strong>åˆå§‹åŒ–</strong>ï¼šè§£æsettings.gradleï¼Œåˆ›å»ºé¡¹ç›®å®ä¾‹</li>
          <li><strong>é…ç½®</strong>ï¼šæ‰§è¡Œæ‰€æœ‰æ„å»ºè„šæœ¬ï¼Œæ„å»ºä»»åŠ¡å›¾</li>
          <li><strong>æ‰§è¡Œ</strong>ï¼šæ‰§è¡Œé€‰å®šçš„ä»»åŠ¡</li>
        </ul>
        <h3>é’©å­</h3>
        <pre>tasks.named('assembleDebug') {
    doFirst {
        println 'å¼€å§‹æ„å»ºDebugç‰ˆæœ¬'
    }
    doLast  {
        println 'æ„å»ºå®Œæˆ'
    }
}

gradle.taskGraph.whenReady { graph ->
    println 'ä»»åŠ¡å›¾å·²å‡†å¤‡å°±ç»ª'
}</pre>
      </div>

      <!-- å¤šæ¨¡å—é¡¹ç›® -->
      <div class="card">
        <h2>ğŸ—ï¸ å¤šæ¨¡å—é¡¹ç›® <a href="https://developer.android.com/build/multi-module-apps" title="å¤šæ¨¡å—å¼€å‘" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>æ¨¡å—å£°æ˜</h3>
        <pre>// settings.gradle.kts
include(":app")
include(":core")
include(":data")
include(":feature:login")
include(":feature:profile")</pre>
        <h3>æ¨¡å—é—´ä¾èµ–</h3>
        <pre>// app/build.gradle.kts
dependencies {
    implementation(project(":core"))
    implementation(project(":data"))
    implementation(project(":feature:login"))
}</pre>
        <h3>å…¬å…±é…ç½®</h3>
        <pre>// build.gradle.kts (é¡¹ç›®çº§åˆ«)
subprojects {
    apply(plugin = "kotlin-android")
    android {
        compileSdk = 34
    }
}</pre>
      </div>

      <!-- æ„å»ºå˜ä½“ä¸é£å‘³ -->
      <div class="card">
        <h2>ğŸ¦ æ„å»ºå˜ä½“ä¸é£å‘³ <a href="https://developer.android.com/build/build-variants" title="æ„å»ºå˜ä½“" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>æ„å»ºç±»å‹</h3>
        <pre>buildTypes {
    debug {
        applicationIdSuffix ".debug"
        debuggable true
        minifyEnabled false
    }
    release {
        minifyEnabled true
        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        signingConfig signingConfigs.release
    }
}</pre>
        <h3>äº§å“é£å‘³</h3>
        <pre>flavorDimensions = "version"
productFlavors {
    free {
        dimension "version"
        applicationIdSuffix ".free"
    }
    pro {
        dimension "version"
        applicationIdSuffix ".pro"
    }
}</pre>
        <div class="desc">æ„å»ºå˜ä½“ = æ„å»ºç±»å‹ Ã— äº§å“é£å‘³</div>
      </div>

      <!-- Kotlin DSL -->
      <div class="card">
        <h2>ğŸ¯ Kotlin DSL <a href="https://developer.android.com/build/kotlin-dsl" title="Kotlin DSL" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>åŸºç¡€é…ç½®</h3>
        <pre>plugins {
    id("com.android.application") version "8.1.0"
    kotlin("android") version "1.9.0"
}

android {
    compileSdk = 34
    defaultConfig {
        applicationId = "com.example.app"
        minSdk = 21
        targetSdk = 34
        versionCode = 1
        versionName = "1.0"
    }
}</pre>
        <h3>ä¾èµ–ç®¡ç†</h3>
        <pre>dependencies {
    implementation(kotlin("stdlib"))
    implementation("androidx.core:core-ktx:1.10.1")
    testImplementation("junit:junit:4.13.2")
}</pre>
      </div>

      <!-- æ€§èƒ½ä¼˜åŒ–ä¸æ„å»ºç¼“å­˜ -->
      <div class="card">
        <h2>âš¡ æ€§èƒ½ä¼˜åŒ–ä¸æ„å»ºç¼“å­˜ <a href="https://developer.android.com/build/optimize-your-build" title="æ„å»ºä¼˜åŒ–" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>gradle.properties</h3>
        <pre>org.gradle.parallel=true              # å¹¶è¡Œæ„å»º
org.gradle.configureondemand=true      # æŒ‰éœ€é…ç½®
org.gradle.caching=true                # å¯ç”¨æ„å»ºç¼“å­˜
org.gradle.daemon=true                 # åå°å®ˆæŠ¤è¿›ç¨‹
org.gradle.jvmargs=-Xmx4g              # JVMå†…å­˜è®¾ç½®</pre>
        <h3>æ„å»ºç¼“å­˜ç±»å‹</h3>
        <ul>
          <li><strong>æœ¬åœ°ç¼“å­˜</strong>ï¼šorg.gradle.caching=true</li>
          <li><strong>è¿œç¨‹ç¼“å­˜</strong>ï¼šé…ç½®HTTPç¼“å­˜æœåŠ¡å™¨</li>
          <li><strong>ä»»åŠ¡è¾“å‡ºç¼“å­˜</strong>ï¼šé¿å…é‡å¤æ‰§è¡Œè¾“å…¥ç›¸åŒçš„ä»»åŠ¡</li>
        </ul>
        <div class="desc">åˆç†é…ç½®å¯æ˜¾è‘—æå‡æ„å»ºé€Ÿåº¦50-80%</div>
      </div>

      <!-- è°ƒè¯•ä¸è¯Šæ–­ -->
      <div class="card">
        <h2>ğŸ” è°ƒè¯•ä¸è¯Šæ–­ <a href="https://developer.android.com/build/build-troubleshooting" title="æ„å»ºè°ƒè¯•" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>æ—¥å¿—çº§åˆ«</h3>
        <pre>./gradlew build --info              # è¯¦ç»†ä¿¡æ¯
./gradlew build --debug              # è°ƒè¯•ä¿¡æ¯
./gradlew build --stacktrace         # å †æ ˆè·Ÿè¸ª
./gradlew build --scan               # ç”ŸæˆBuild Scan</pre>
        <h3>æ„å»ºåˆ†æ</h3>
        <pre>// æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œæ—¶é—´
./gradlew assembleDebug --profile

// æŸ¥çœ‹ä»»åŠ¡ä¾èµ–å›¾
./gradlew tasks --all
./gradlew app:dependencies</pre>
        <h3>å†…å­˜åˆ†æ</h3>
        <pre>// å¼€å¯JVMå†…å­˜åˆ†æ
org.gradle.jvmargs=-Xmx4g -XX:+HeapDumpOnOutOfMemoryError</pre>
      </div>

      <!-- å±æ€§ä¸æ‰©å±• -->
      <div class="card">
        <h2>ğŸ”§ å±æ€§ä¸æ‰©å±• <a href="https://developer.android.com/build/gradle-tips" title="GradleæŠ€å·§" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>Extraå±æ€§</h3>
        <pre>// Groovy
ext {
    kotlin_version = '1.9.0'
    compileSdkVersion = 34
    targetSdkVersion = 34
}

// Kotlin DSL
ext["kotlin_version"] = "1.9.0"
ext.set("compileSdkVersion", 34)</pre>
        <h3>é¡¹ç›®å±æ€§</h3>
        <pre>def env = project.findProperty("env") ?: "dev"
def isReleaseBuild = gradle.startParameter.taskNames.any { it.toLowerCase().contains("release") }</pre>
        <h3>è‡ªå®šä¹‰æ‰©å±•</h3>
        <pre>android.buildFeatures {
    viewBinding true
    dataBinding true
}</pre>
      </div>

      <!-- CI/CDé›†æˆ -->
      <div class="card">
        <h2>ğŸš€ CI/CDé›†æˆ <a href="https://developer.android.com/build/building-cd-integration" title="æŒç»­é›†æˆ" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>å¸¸ç”¨å‘½ä»¤</h3>
        <pre>./gradlew assembleRelease -Penv=prod
./gradlew test --continue
./gradlew clean assembleDebug testDebugUnitTest</pre>
        <h3>GitHub Actions</h3>
        <pre>name: Android CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'
      - name: Build with Gradle
        run: ./gradlew assembleDebug</pre>
        <div class="desc">ä½¿ç”¨å®˜æ–¹actions/setup-javaä¼˜åŒ–JDKè®¾ç½®</div>
      </div>

      <!-- ç­¾åé…ç½® -->
      <div class="card">
        <h2>ğŸ” ç­¾åé…ç½® <a href="https://developer.android.com/build/build-variants#signing" title="åº”ç”¨ç­¾å" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>ç­¾åå£°æ˜</h3>
        <pre> signingConfigs {
    debug {
        storeFile file('debug.keystore')
        storePassword 'android'
        keyAlias 'androiddebugkey'
        keyPassword 'android'
    }
    release {
        storeFile file('release.keystore')
        storePassword System.getenv("STORE_PASSWORD")
        keyAlias System.getenv("KEY_ALIAS")
        keyPassword System.getenv("KEY_PASSWORD")
    }
}</pre>
        <h3>ç¯å¢ƒå˜é‡</h3>
        <pre>// gradle.properties
RELEASE_STORE_FILE=../release.keystore
RELEASE_STORE_PASSWORD=your_password
RELEASE_KEY_ALIAS=your_alias
RELEASE_KEY_PASSWORD=your_password</pre>
        <div class="desc">ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡</div>
      </div>

      <!-- ä»£ç æ··æ·†ä¸å‹ç¼© -->
      <div class="card">
        <h2>ğŸ”’ ä»£ç æ··æ·†ä¸å‹ç¼© <a href="https://developer.android.com/build/shrink-code" title="ä»£ç å‹ç¼©" target="_blank" style="color:#93cdfc;">>>></a></h2>
        <h3>æ··æ·†é…ç½®</h3>
        <pre>buildTypes {
    release {
        minifyEnabled true
        shrinkResources true
        proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'

        // R8è°ƒè¯•
        android.enableR8.fullMode = true
    }
}</pre>
        <h3>proguard-rules.pro</h3>
        <pre># ä¿æŒå®ä½“ç±»
-keep class com.example.app.model.** { *; }

# ä¿æŒæ³¨è§£
-keepattributes *Annotation*

# ä¿æŒGsonä½¿ç”¨
-keepattributes Signature
-dontwarn sun.misc.**
-keep class com.google.gson.** { *; }</pre>
        <div class="desc">R8æ˜¯é»˜è®¤ä»£ç å‹ç¼©å™¨ï¼Œæ”¯æŒæ›´ aggressiveçš„ä¼˜åŒ–</div>
      </div>
    </div>
  </div>
  <script>
    document.getElementById('columnWidth').addEventListener('input', function(e) {
      const width = e.target.value;
      document.getElementById('widthVal').textContent = width + 'px';
      const columns = document.getElementById('columns');
      columns.style.columnWidth = width + 'px';
    });
  </script>
</body>
</html>